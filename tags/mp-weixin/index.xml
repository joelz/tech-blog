<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Mp-Weixin on Notes by Joel</title><link>https://joelz.github.io/tech-blog/tags/mp-weixin/</link><description>Recent content in Mp-Weixin on Notes by Joel</description><generator>Hugo</generator><language>en-us</language><copyright>Copy, right? 🤔</copyright><lastBuildDate>Mon, 18 Apr 2022 12:01:58 +0800</lastBuildDate><atom:link href="https://joelz.github.io/tech-blog/tags/mp-weixin/index.xml" rel="self" type="application/rss+xml"/><item><title>小程序及App内嵌H5</title><link>https://joelz.github.io/tech-blog/posts/20220418-weixin_mp_webview/</link><pubDate>Mon, 18 Apr 2022 12:01:58 +0800</pubDate><guid>https://joelz.github.io/tech-blog/posts/20220418-weixin_mp_webview/</guid><description>微信小程序内嵌 H5 通信机制 微信小程序向 H5 发送消息 URL search 传参：在 H5 初始加载时，通常会带上用户的登录态作为参数，使 H5 可以继续与后台交互。类似 https://example.com/h5.html?token=SGVsbG9Xb3JkIQ== URL hash 传参：在 H5 浏览期间，可以 利用网页 URL 中的 hash 部分改变不会导致网页重新加载的特点，实现小程序向 H5 发送消息。但是：【报Bug】UNIAPP H5修改hash模式的URL参数会导致页面重载，以前旧的hbx2.8.11是不会重载的 - DCloud问答 websocket H5 向微信小程序发送消息 postMessage：小程序内嵌 H5 可以使用 JSSDK 向小程序发送消息。网页向小程序 postMessage 时，只会在特定时机（小程序后退、组件销毁、分享）触发并收到消息，不是实时触发。e.detail = { data }，data是多次 postMessage 的参数组成的数组 路由传参：在使用 JSSDK 调起小程序页面时，可以通过在页面路径后携带参数的方式通信。类似 wx.miniProgram.navigateTo({ url: '/path/to/page?foo=bar' }) websocket 不足 对于需要用户交互才能使用的小程序能力（比如分享，获取用户手机号，获取用户信息，获取用户头像，订阅消息等），需要跳转页面 WebView 页面的导航栏只能固定用默认的白底黑字风格 参考链接 微信小程序混合开发笔记 微信小程序+webview+vue混合开发 传值踩坑_choutian5268的博客-CSDN博客 【报Bug】UNIAPP H5修改hash模式的URL参数会导致页面重载，以前旧的hbx2.8.11是不会重载的 - DCloud问答 - web-view | 微信开放文档 App内嵌 H5 通信机制 App向 H5 发送消息 evalJS： 1 2 3 4 5 const js = `window.</description></item><item><title>微信小程序持续集成相关</title><link>https://joelz.github.io/tech-blog/posts/20210715-miniprogram_ci/</link><pubDate>Thu, 15 Jul 2021 12:01:58 +0800</pubDate><guid>https://joelz.github.io/tech-blog/posts/20210715-miniprogram_ci/</guid><description>预览和上传的区别 微信开发者工具有两个按钮：预览和上传。
miniprogram-ci 是从微信开发者工具中抽离的关于小程序/小游戏项目代码的编译模块，有 ci.preview和ci.upload两个方法。和上两个按钮对应。
预览时，只能在小程序助手的开发版列表中看到，在PC Web小程序后台的开发版列表看不到。 上传时，只能在PC Web小程序后台的开发版列表看到，在小程序助手的开发版列表中看不到。
只有在PC Web小程序后台才可进行「选为体验版本」及「提交审核」操作。
所以现在的做法是在preview.js中先执行一次ci.preview，再执行一次ci.upload。
links 用__wxConfig.envVersion区分小程序体验版，开发板，正式版 | 微信开放社区 小程序助手里面的版本查看的开发版不能自动更新啊 | 微信开放社区 使用 miniprogram-ci 上传的版本在小程序助手里看不见？ | 微信开放社区 微信开发者工具交流专区 | 微信开放社区 可否在小程序助手里提供发布版本的功能? | 微信开放社区 开发者工具上传后，小程序助手没有该版本显示？ | 微信开放社区 一次奇怪的bug 有一天发现线上的小程序有奇怪的样式问题，同样的代码在我们自己电脑上打包传上去却没有问题。最后发现是jenkins上的pipeline里面使用的miniprogram-ci使用的版本太旧了。se照着package.json来确定的版本号，但是在我们本地，我们用的yarn.lock中的版本。
微信小程序强制更新 从文档可以看出，判断小程序是否有新版本和下载小程序新版本代码都是由微信自行负责，我们的代码无法介入。我们的代码能够做的就是：「如果需要马上应用最新版本，可以使用 wx.getUpdateManager API 进行处理。」
updateManager.applyUpdate()会有一次系统提示框，所以我们自己的代码就不需要提示用户了。
links 微信小程序发布新版本时自动提示用户更新 - 逍遥云天 - 博客园 uni-app 小程序更新后强制用户升级 - 瞭月 (3)强制更新 | 微信开放社区 小程序更新机制 | 微信开放文档 UpdateManager | 微信开放文档 https://developers.weixin.qq.com/community/search?query=UpdateManager&amp;amp;block=1&amp;amp;blogcategory=0&amp;amp;sort=0&amp;amp;time=0&amp;amp;starttime=&amp;amp;endtime=&amp;amp;type%5Bpage%5D=1&amp;amp;type%5Bblock%5D=1&amp;amp;type%5Btype%5D=1&amp;amp;type%5Bquery%5D=UpdateManager&amp;amp;page=2 为什么小程序更新提示只有ios用户有，安卓用户看不到更新提示？ | 微信开放社区 这几天小程序的updateManager.onCheckForUpdate 安卓不能用了，苹果好使 | 微信开放社区 版本更新提醒，工具上好用，真机就没反应？ | 微信开放社区 updateManager.</description></item></channel></rss>