<!doctype html><html><head><title>Capacitor setup in Apple M1 Mac</title>
<meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content="如何在 M1 芯片的 MacBook 上配置 Capacitor 开发"><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><meta property="og:url" content="https://joelz.github.io/tech-blog/posts/20210504-capacitor_setup_in_apple_m1/"><meta property="og:site_name" content="Notes by Joel"><meta property="og:title" content="Capacitor setup in Apple M1 Mac"><meta property="og:description" content="如何在 M1 芯片的 MacBook 上配置 Capacitor 开发"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-04T12:01:58+08:00"><meta property="article:modified_time" content="2021-05-04T12:01:58+08:00"><meta property="article:tag" content="App"><meta property="article:tag" content="Capacitor"><meta name=twitter:card content="summary"><meta name=twitter:title content="Capacitor setup in Apple M1 Mac"><meta name=twitter:description content="如何在 M1 芯片的 MacBook 上配置 Capacitor 开发"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","abcdefghzd")</script><script src=/tech-blog/js/toc.js></script><link type=text/css rel=stylesheet href=/tech-blog/vendor/css/bootstrap.min.css><link rel=stylesheet href=/tech-blog/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"></head><body><div id=app><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item active" href=/tech-blog/posts>Archive
</a><a class="a-block drawer-menu-item false" href=/tech-blog/categories>Categories
</a><a class="a-block drawer-menu-item false" href=/tech-blog/tags>Tags
</a><a class="a-block drawer-menu-item false" href=/tech-blog/index.xml>RSS Feed</a><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><ul><li><a href=#%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83 class=nav-运行环境>运行环境</a></li><li><a href=#web class=nav-web>Web</a></li><li><a href=#ios class=nav-ios>iOS</a></li><ul><li><a href=#%e4%bf%ae%e6%94%b9appid class=nav-修改appid>修改appId</a></li><li><a href=#%e5%ae%89%e8%a3%85arm%e7%89%88cocoapod class=nav-安装arm版cocoapod>安装arm版CocoaPod</a></li><li><a href=#%e5%ae%89%e8%a3%85pod%e4%be%9d%e8%b5%96 class=nav-安装pod依赖>安装pod依赖</a></li><li><a href=#%e5%9c%a8xcode%e4%b8%ad%e8%bf%90%e8%a1%8c%e9%a1%b9%e7%9b%ae class=nav-在xcode中运行项目>在Xcode中运行项目</a></li><li><a href=#live-reload class=nav-live-reload>live reload</a></li><li><a href=#%e4%bd%bf%e7%94%a8safari-web-inspector%e6%9d%a5%e8%b0%83%e8%af%95ios%e6%89%8b%e6%9c%ba%e4%b8%8a%e7%9a%84app class=nav-使用safari-web-inspector来调试ios手机上的app>使用Safari Web Inspector来调试iOS手机上的app</a></li></ul><li><a href=#android class=nav-android>Android</a></li><ul><li><a href=#%e5%ae%89%e8%a3%85android-sdk class=nav-安装android-sdk>安装android sdk</a></li><li><a href=#%e5%9c%a8android-studio%e4%b8%ad%e8%bf%90%e8%a1%8c%e9%a1%b9%e7%9b%ae class=nav-在android-studio中运行项目>在Android Studio中运行项目</a></li><li><a href=#live-reload-ios-live-reload%e6%b2%a1%e8%bf%90%e8%a1%8c class=nav-live-reload-ios-live-reload没运行>live reload (iOS live reload没运行)</a></li><li><a href=#live-reload-ios-live-reload%e5%b7%b2%e8%bf%90%e8%a1%8c class=nav-live-reload-ios-live-reload已运行>live reload (iOS live reload已运行)</a></li><li><a href=#%e4%bd%bf%e7%94%a8chrome-devtools%e6%9d%a5%e8%b0%83%e8%af%95android%e6%89%8b%e6%9c%ba%e4%b8%8a%e7%9a%84app class=nav-使用chrome-devtools来调试android手机上的app>使用Chrome DevTools来调试Android手机上的app</a></li><li><a href=#%e4%bd%bf%e7%94%a8intellij-idea-ce- class=nav-使用intellij-idea-ce->使用IntelliJ IDEA CE ?</a></li></ul><li><a href=#%e7%9c%9f%e5%ae%9e%e7%9a%84capacitor%e9%a1%b9%e7%9b%ae%e5%9c%a8apple-m1%e4%b8%8a%e5%8f%af%e4%bb%a5%e6%ad%a3%e5%b8%b8build%e5%90%97 class=nav-真实的capacitor项目在apple-m1上可以正常build吗>真实的Capacitor项目在Apple M1上可以正常build吗</a></li><li><a href=#links class=nav-links>links</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu
</i></button>
<a id=navTitle class=navbar-brand href=https://joelz.github.io/tech-blog/>Notes by Joel
</a><button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://joelz.github.io/tech-blog/><div class=single-column-header-title>Notes by Joel</div><div class=single-column-header-subtitle>Bytes and Bits, Piece by Piece.</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper style=background-image:url(https://joelz.github.io/tech-blog/images/notebook.jpg)><div class=post-title>Capacitor setup in Apple M1 Mac<div class=post-subtitle>如何在 M1 芯片的 MacBook 上配置 Capacitor 开发</div><div class=post-meta><time itemprop=datePublished>2021-05-04 12:01
</time><i class=material-icons>folder</i>
<a href=/categories/app>app</a>
&nbsp;
<i class=material-icons>label</i>
<a href=/tags/app>app</a>
&nbsp;
<a href=/tags/capacitor>capacitor</a>
&nbsp;</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h2 id=运行环境>运行环境</h2><p>macOS Big Sur 11.2.2
Xcode 12.4
Android Studio 4.1.3
node 14.16.1
Capacitor 2.4.1
Vue 3.0</p><h2 id=web>Web</h2><pre tabindex=0><code>npm install -g @ionic/cli
git clone https://github.com/ionic-team/tutorial-photo-gallery-vue.git
cd photo-gallery-capacitor-vue
npm install
ionic serve
</code></pre><h2 id=ios>iOS</h2><h3 id=修改appid>修改appId</h3><p>git clone下来的代码里面的appId是<code>io.ionic.demo.pg.vue</code>，要换成自己的。VS Code打开代码文件夹，查找替换该appId为新的appId（比如<code>com.dc1979.capacitor.demo.vue</code>）</p><h3 id=安装arm版cocoapod>安装arm版CocoaPod</h3><p>参考的是这个SO：https://stackoverflow.com/a/66556339</p><ol><li>确认安装了arm版Homebrew：<code>which brew</code>返回的结果是 <code>/opt/homebrew/bin/brew</code>。不是的话就按照这篇文章去安装arm版Homebrew：<a href=https://sspai.com/post/63935>在 M1 芯片 Mac 上使用 Homebrew</a></li><li>安装arm版ruby：<code>brew install ruby</code></li><li>把环境变量加到PATH中：<code>echo 'export PATH="/opt/homebrew/opt/ruby/bin:/opt/homebrew/lib/ruby/gems/3.0.0/bin:$PATH"' >> ~/.zshrc</code></li><li>Execute <code>source ~/.zshrc</code> or restart your shell</li><li>确定<code>which ruby</code>返回的是<code>$(brew --prefix)/opt/ruby/bin/ruby</code></li><li>Install CocoaPods with <code>sudo gem install cocoapods</code></li><li>Make sure you are using the correct pod binary by executing <code>which pod</code> (should be <code>$(brew --prefix)/lib/ruby/gems/3.0.0/bin/pod</code>)</li><li>Make sure ethon is version 0.13.0 or more with <code>gem info ethon</code>, otherwise run <code>sudo gem install ethon</code></li></ol><h3 id=安装pod依赖>安装pod依赖</h3><ol><li>运行<code>cd ios/App/</code></li><li>运行<code>pod install</code></li></ol><h3 id=在xcode中运行项目>在Xcode中运行项目</h3><ol><li>在项目根目录下运行<code>ionic cap sync</code>。可能最后会报错说sh pod install不成功，忽略它即可，因为我们上一步已经执行了pod install</li><li><code>ionic cap open ios</code></li><li>在打开的Xcode中，登录自己的Apple ID，选择Automatically manage signing（如果有开发者账号的话，就选对应的profile）</li><li>运行到模拟器或者真机</li></ol><h3 id=live-reload>live reload</h3><ol><li>在项目根目录下运行<code>ionic cap run ios -l --external</code></li><li>到Xcode中运行项目到模拟器或者真机</li></ol><h3 id=使用safari-web-inspector来调试ios手机上的app>使用Safari Web Inspector来调试iOS手机上的app</h3><p>因为Capacitor app本质上就是一个WebView，所以可以用Safari Web Inspector来调试Capacitor app里面的代码。</p><ol><li>在iPhone或者iPad上 启用「网页检查器」：进入 设置 > Safari 浏览器> 高级 中，启用「网页检查器」</li><li>在mac电脑上，打开Safari，在 Safari > Preferences > Advanced 中，勾选 Show Develop menu in menu bar。重启Safari。</li><li>将iPhone或者iPad连接到mac电脑上，运行Capacitor app，在Safari的 Develop > [你的iOS设备名称]下面，点击需要调试的页面（一般就是localhost - xxx），打开Web Inspector。</li></ol><h2 id=android>Android</h2><h3 id=安装android-sdk>安装android sdk</h3><p>安装Android Studio，打开它，安装android sdk（需要先配置代理翻墙）</p><h3 id=在android-studio中运行项目>在Android Studio中运行项目</h3><ol><li>因为在iOS部分我们已经运行过<code>ionic cap sync</code>，所以android project其实已经准备好了</li><li><code>ionic cap open android</code></li><li>在打开的Android Studio中，运行项目到真机（模拟器暂时在M1上还不行，只有preview版本）</li></ol><h3 id=live-reload-ios-live-reload没运行>live reload (iOS live reload没运行)</h3><ol><li>在项目根目录下运行<code>ionic cap run android -l --external</code></li><li>到Android Studio中运行项目到真机</li></ol><h3 id=live-reload-ios-live-reload已运行>live reload (iOS live reload已运行)</h3><ol><li>新开一个terminal窗口</li><li>在项目根目录下运行<code>npx cap copy android&&amp;npx cap open android</code></li><li>到Android Studio中运行项目到真机</li></ol><h3 id=使用chrome-devtools来调试android手机上的app>使用Chrome DevTools来调试Android手机上的app</h3><p>因为Capacitor app本质上就是一个WebView，所以可以用Chrome DevTools来调试Capacitor app里面的代码。</p><ol><li>在Android手机上的开发者选项中启用USB调试</li><li>打开Chrome，在地址栏中输入<code>chrome://inspect#devices</code>，回车</li><li>在Chrome Devices页面上查看Discover USB devices是否已经勾选，没有的话勾选上</li><li>将Anroid手机连接到电脑，Android手机上会询问「是否允许USB调试」，选择「允许」</li><li>此时该Android手机应该会出现在Chrome Devices页面上，点击对应页面下面的「inspect」链接，就可以看见和Web开发时一样的DevTools页面了</li></ol><p>更多信息可以参考Chrome官方的文档：<a href=https://developer.chrome.com/docs/devtools/remote-debugging/>Remote debug Android devices - Chrome Developers</a></p><h3 id=使用intellij-idea-ce->使用IntelliJ IDEA CE ?</h3><p>因为Android Studio暂时还不支持Apple M1（20210504），网上有人建议用IntelliJ IDEA CE来编辑和运行android项目，暂时还没测试。
安装IntelliJ IDEA CE后，第一件事情也是配置代理翻墙。</p><h2 id=真实的capacitor项目在apple-m1上可以正常build吗>真实的Capacitor项目在Apple M1上可以正常build吗</h2><p>测试了Clubhouse App，可以。</p><h2 id=links>links</h2><ul><li><a href=https://www.jianshu.com/p/ef16b3bec42b>M1芯片Mac搭建前端开发环境 - 简书</a></li><li><a href=https://zhuanlan.zhihu.com/p/345284558>Apple Silicon 移动端开发填坑记录（持续更新） - 知乎</a></li><li><a href=https://stackoverflow.com/questions/16904658/node-version-manager-install-nvm-command-not-found>node.js - Node Version Manager install - nvm command not found - Stack Overflow</a></li><li><a href=https://www.jetbrains.com/help/idea/create-your-first-android-application.html#Android-make-application-interactive>Tutorial: Create your first Android application | IntelliJ IDEA</a></li><li><a href=https://medium.com/mobile-app-development-publication/speed-up-android-compilation-in-apple-m1-device-6dbca65b4bb9>Speed up Android Compilation in Apple M1 Device | by Elye | Mobile App Development Publication | Apr, 2021 | Medium</a></li></ul><hr width=100% id=EOF><p style=color:#777>Last modified on 2021-05-04</p></div></div><nav class=post-pagination><a class=newer-posts href=/tech-blog/posts/20210715-miniprogram_ci/>Next<br>微信小程序持续集成相关
</a><a class=older-posts>Previous<br>No older posts.</a></nav><div class=post-comment-wrapper><p style=opacity:.6 align=center><small>Comments Disabled.</small></p></div></div></div></div></div><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://joelz.github.io/tech-blog/><div class=nav-title>Notes by Joel</div><div class=nav-subtitle>Bytes and Bits, Piece by Piece.</div></a><div class=nav-link-list><a class="a-block nav-link-item active" href=/tech-blog/posts>Archive
</a><a class="a-block nav-link-item false" href=/tech-blog/categories>Categories
</a><a class="a-block nav-link-item false" href=/tech-blog/tags>Tags
</a><a class="a-block nav-link-item false" href=/tech-blog/index.xml>RSS Feed</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copy, right? 🤔</div></div><div id=extraContainer class=extra-container><div class=toc-wrapper><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><ul><li><a href=#%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83 class=nav-运行环境>运行环境</a></li><li><a href=#web class=nav-web>Web</a></li><li><a href=#ios class=nav-ios>iOS</a></li><ul><li><a href=#%e4%bf%ae%e6%94%b9appid class=nav-修改appid>修改appId</a></li><li><a href=#%e5%ae%89%e8%a3%85arm%e7%89%88cocoapod class=nav-安装arm版cocoapod>安装arm版CocoaPod</a></li><li><a href=#%e5%ae%89%e8%a3%85pod%e4%be%9d%e8%b5%96 class=nav-安装pod依赖>安装pod依赖</a></li><li><a href=#%e5%9c%a8xcode%e4%b8%ad%e8%bf%90%e8%a1%8c%e9%a1%b9%e7%9b%ae class=nav-在xcode中运行项目>在Xcode中运行项目</a></li><li><a href=#live-reload class=nav-live-reload>live reload</a></li><li><a href=#%e4%bd%bf%e7%94%a8safari-web-inspector%e6%9d%a5%e8%b0%83%e8%af%95ios%e6%89%8b%e6%9c%ba%e4%b8%8a%e7%9a%84app class=nav-使用safari-web-inspector来调试ios手机上的app>使用Safari Web Inspector来调试iOS手机上的app</a></li></ul><li><a href=#android class=nav-android>Android</a></li><ul><li><a href=#%e5%ae%89%e8%a3%85android-sdk class=nav-安装android-sdk>安装android sdk</a></li><li><a href=#%e5%9c%a8android-studio%e4%b8%ad%e8%bf%90%e8%a1%8c%e9%a1%b9%e7%9b%ae class=nav-在android-studio中运行项目>在Android Studio中运行项目</a></li><li><a href=#live-reload-ios-live-reload%e6%b2%a1%e8%bf%90%e8%a1%8c class=nav-live-reload-ios-live-reload没运行>live reload (iOS live reload没运行)</a></li><li><a href=#live-reload-ios-live-reload%e5%b7%b2%e8%bf%90%e8%a1%8c class=nav-live-reload-ios-live-reload已运行>live reload (iOS live reload已运行)</a></li><li><a href=#%e4%bd%bf%e7%94%a8chrome-devtools%e6%9d%a5%e8%b0%83%e8%af%95android%e6%89%8b%e6%9c%ba%e4%b8%8a%e7%9a%84app class=nav-使用chrome-devtools来调试android手机上的app>使用Chrome DevTools来调试Android手机上的app</a></li><li><a href=#%e4%bd%bf%e7%94%a8intellij-idea-ce- class=nav-使用intellij-idea-ce->使用IntelliJ IDEA CE ?</a></li></ul><li><a href=#%e7%9c%9f%e5%ae%9e%e7%9a%84capacitor%e9%a1%b9%e7%9b%ae%e5%9c%a8apple-m1%e4%b8%8a%e5%8f%af%e4%bb%a5%e6%ad%a3%e5%b8%b8build%e5%90%97 class=nav-真实的capacitor项目在apple-m1上可以正常build吗>真实的Capacitor项目在Apple M1上可以正常build吗</a></li><li><a href=#links class=nav-links>links</a></li></ul></div></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up
</i></a><a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
Copy, right? 🤔</div></div><script src=/tech-blog/js/journal.js></script></body></html>